# Research: AWS Lambda symlink support

## Question

Does AWS Lambda support symlinks in zip deployment packages?

## Answer

**Yes, AWS Lambda supports symlinks in zip archives.**

From [terraform-aws-modules/terraform-aws-lambda#596](https://github.com/terraform-aws-modules/terraform-aws-lambda/issues/596):

> "counter to some misinformation online, AWS Lambda itself does support this"

The issue is not with Lambda, but with **tooling** that creates the zip archives. Many tools (including the Terraform Lambda module) dereference symlinks by default, copying file contents instead of preserving symlink references.

## How to preserve symlinks in zip

The standard `zip` utility supports preserving symlinks with the `--symlinks` or `-y` flag:

```bash
zip --symlinks -r artifact.zip contents/
```

From [Server Fault](https://serverfault.com/questions/265675/how-can-i-zip-compress-a-symlink):

> "You can store symlinks as symlinks (as opposed to a copy of the file/directory they point to) using the `--symlinks` or `-y` parameters of the zip program."

## Caveats

### Python's zipfile module

From [Stack Overflow](https://stackoverflow.com/questions/19737570/how-do-i-preserve-symlinks-when-unzipping-an-archive-using-python):

> "There seems to be no way to preserve symlinks using Python's zipfile module."

If using Python for zipping, you'd need to use subprocess to call the system `zip` command.

### Cross-platform

Symlinks in zip work correctly on Linux (which Lambda runs on). Windows may not preserve them when extracting.

### Serverless Framework

From [Stack Overflow](https://stackoverflow.com/questions/66002119/how-can-i-package-symbolic-link-in-node-modules-with-serverless):

The Serverless Framework doesn't handle symlinks well by default. The recommended workaround is using bundlers like webpack, but that's overkill if we can just preserve symlinks properly.

## Conclusion

**Preserving symlinks is viable for Lambda.** We need to:

1. Use `zip --symlinks` instead of Node.js zip libraries
2. Or find a Node.js zip library that supports symlinks
3. Ensure the traced symlinks have valid relative targets within the artifact

## Sources

- [terraform-aws-modules/terraform-aws-lambda#596](https://github.com/terraform-aws-modules/terraform-aws-lambda/issues/596)
- [Server Fault: How can I zip/compress a symlink?](https://serverfault.com/questions/265675/how-can-i-zip-compress-a-symlink)
- [Stack Overflow: How do I preserve symlinks when unzipping?](https://stackoverflow.com/questions/19737570/how-do-i-preserve-symlinks-when-unzipping-an-archive-using-python)
- [Stack Overflow: Package symbolic link with serverless](https://stackoverflow.com/questions/66002119/how-can-i-package-symbolic-link-in-node-modules-with-serverless)
